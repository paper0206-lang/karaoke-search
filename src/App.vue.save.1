<template>
  <div>
    <h1>å¡æ‹‰OK é»æ­Œæœ¬æŸ¥è©¢</h1>

    <div>
      <h2>æŸ¥è©¢æ­Œæ›²ç·¨è™Ÿ</h2>
      <input v-model="songName" placeholder="è¼¸å…¥æ­Œæ›²åç¨±" />
      <button @click="searchBySongName">æŸ¥è©¢</button>
      <ul v-if="Object.keys(songResults).length">
        <li v-for="(number, machine) in songResults" :key="machine">
          ğŸ¤ <strong>{{ machine }}</strong>: {{ number }}
        </li>
      </ul>
    </div>
  </div>
</template>

<script>
import { ref } from "vue";
import { db, collection, query, where, getDocs } from "./firebase";

export default {
  setup() {
    const songName = ref(""); // è¼¸å…¥çš„æ­Œå
    const songResults = ref({}); // å­˜æ”¾æŸ¥è©¢çµæœï¼ˆæ‰€æœ‰æ©Ÿç¨®çš„é»æ­Œç·¨è™Ÿï¼‰

    // ğŸ” **æŸ¥è©¢æ­Œæ›²åç¨±å°æ‡‰çš„æ‰€æœ‰æ©Ÿç¨®é»æ­Œç·¨è™Ÿ**
    const searchBySongName = async () => {
      if (!songName.value) return; // é˜²æ­¢ç©ºæŸ¥è©¢

      const q = query(collection(db, "songs"), where("name", "==", songName.value));
      const querySnapshot = await getDocs(q);

      if (!querySnapshot.empty) {
        const songData = querySnapshot.docs[0].data();
        songResults.value = songData.karaoke_machines || {};
      } else {
        songResults.value = {}; // æ²’æœ‰æ‰¾åˆ°æ­Œæ›²
      }
    };

    return { songName, songResults, searchBySongName };
  }
};
</script>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

input, select, button {
  margin: 5px;
  padding: 8px;
  font-size: 16px;
}
</style>
