<template>
  <div>
    <h1>卡拉OK 點歌本查詢</h1>

    <div>
      <h2>查詢歌曲編號</h2>
      <input v-model="songName" placeholder="輸入歌曲名稱" />
      <button @click="searchBySongName">查詢</button>
      <ul v-if="Object.keys(songResults).length">
        <li v-for="(number, machine) in songResults" :key="machine">
          🎤 <strong>{{ machine }}</strong>: {{ number }}
        </li>
      </ul>
    </div>
  </div>
</template>

<script>
import { ref } from "vue";
import { db, collection, query, where, getDocs } from "./firebase";

export default {
  setup() {
    const songName = ref(""); // 輸入的歌名
    const songResults = ref({}); // 存放查詢結果（所有機種的點歌編號）

    // 🔍 **查詢歌曲名稱對應的所有機種點歌編號**
    const searchBySongName = async () => {
      if (!songName.value) return; // 防止空查詢

      const q = query(collection(db, "songs"), where("name", "==", songName.value));
      const querySnapshot = await getDocs(q);

      if (!querySnapshot.empty) {
        const songData = querySnapshot.docs[0].data();
        songResults.value = songData.karaoke_machines || {};
      } else {
        songResults.value = {}; // 沒有找到歌曲
      }
    };

    return { songName, songResults, searchBySongName };
  }
};
</script>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

input, select, button {
  margin: 5px;
  padding: 8px;
  font-size: 16px;
}
</style>
